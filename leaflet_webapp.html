<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <title>Leaflet – NV SenterlinjePortefolje (FeatureServer)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Leaflet CSS (må være <link>, ikke bare URL på en linje) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <style>
    html, body { height: 100%; margin: 0; }
    #map { width: 100%; height: 100%; }
    .error {
      position: absolute; left: 50%; top: 10px; transform: translateX(-50%);
      background: #fff3f3; color: #7a1f1f; border: 1px solid #f2caca;
      padding: 8px 12px; border-radius: 8px; font: 14px/1.3 system-ui, sans-serif;
      z-index: 1000; display: none;
    }
  </style>
</head>
<body>
  <div id="map" role="region" aria-label="Kart"></div>
  <div class="error" id="errBox">Kunne ikke laste kartlaget. Sjekk at tjenesten er offentlig og at URL peker til riktig layer (f.eks. …/FeatureServer/0).</div>

  <!-- Leaflet JS (må være <script src="...">) -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <!-- Esri Leaflet for AGOL/ArcGIS-tjenester -->
  <script src="https://unpkg.com/esri-leaflet@3.0.11/dist/esri-leaflet.js"></script>

  <script>
    // 1) Initier kart (Norge som start)
    const map = L.map('map', { center: [64.5, 12.0], zoom: 5 });

    // 2) Basiskart
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19, attribution: '&copy; OpenStreetMap-bidragsytere'
    }).addTo(map);

    // 3) DITT FeatureServer-lag – NB: peke på layer-id '/0'
    const serviceRoot = 'https://services-eu1.arcgis.com/Zxn04POL7OfqZkir/arcgis/rest/services/NV_SenterlinjePortefolje_Niv0/FeatureServer';
    const layerUrl = serviceRoot + '/0';

    const errBox = document.getElementById('errBox');

    // 4) Legg til laget med enkel linjestil
    const layer = L.esri.featureLayer({
      url: layerUrl,
      where: '1=1',
      style: () => ({ color: '#005b82', weight: 3, opacity: 0.9 }),
      fields: ['*'] // hent alle felter for popup
    })
    .on('load', () => {
      // Zoom til data når første batch er lastet
      try {
        const b = layer.getBounds();
        if (b.isValid()) map.fitBounds(b, { padding: [24, 24] });
      } catch (e) { /* ignore */ }
    })
    .on('requesterror', (e) => {
      console.error('FeatureLayer requesterror:', e);
      errBox.style.display = 'block';
    })
    .addTo(map);

    // 5) Generisk popup som viser alle attributter
    layer.bindPopup(({ feature }) => {
      const p = feature?.properties || {};
      const html = Object.entries(p).map(([k,v]) => `<div><b>${k}</b>: ${v}</div>`).join('');
      return html || 'Ingen attributter';
    });
  </script>
</body>
</html>
