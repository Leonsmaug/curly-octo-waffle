<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <title>Leaflet – NV SenterlinjePortefolje Nivå 0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <style>
    html, body { height: 100%; margin: 0; }
    #map { width: 100%; height: 100%; }
    .legend { position: absolute; z-index: 1000; right: 12px; bottom: 12px;
      background: rgba(255,255,255,.95); border-radius: 8px; padding: 8px 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,.15); font: 12px/1.3 system-ui, sans-serif; }
  </style>
</head>
<body>
  <div id="map" role="region" aria-label="Kart"></div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <!-- Esri Leaflet (for ArcGIS Feature/Map services) -->
  <script src="https://unpkg.com/esri-leaflet@3.0.11/dist/esri-leaflet.js"
          integrity="sha256-Ey6xv8S6U3W3v1G8A7I7UF5E8ECG1w0ze+XLJ4hkw8U="
          crossorigin=""></script>

  <script>
    // === 1) Initier kart ===
    const map = L.map('map', { center: [64.5, 12.0], zoom: 5 });

    // Basiskart (OSM)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19, attribution: '&copy; OpenStreetMap-bidragsytere'
    }).addTo(map);

    // === 2) Ditt FeatureServer-lag (antar layer 0) ===
    const serviceRoot = 'https://services-eu1.arcgis.com/Zxn04POL7OfqZkir/arcgis/rest/services/NV_SenterlinjePortefolje_Niv0/FeatureServer';
    const layerUrl = serviceRoot + '/0';

    // Standard stil (juster fritt)
    const styleFn = (f) => {
      // prøver å fargelegge basert på et felt hvis det finnes (safe fallback)
      const c = '#005b82';
      return { color: c, weight: 3, opacity: 0.9 };
    };

    const featureLyr = L.esri.featureLayer({
      url: layerUrl,
      // Hent alle objekter (begrens evt. med 'where')
      where: '1=1',
      simplifyFactor: 0.5,
      precision: 5,
      style: styleFn
    })
    .on('load', (e) => {
      try {
        map.fitBounds(featureLyr.getBounds(), { padding: [20,20] });
      } catch(_) {
        // Hvis laget er tomt eller bounds ikke kan beregnes, gjør ingenting
      }
    })
    .on('requesterror', (err) => {
      console.error('Feil ved henting av laget:', err);
      alert('Kunne ikke laste AGOL-laget. Er det offentlig og riktig layer-indeks?');
    })
    .addTo(map);

    // Popup med felt (generisk)
    featureLyr.bindPopup(function (layer) {
      const p = layer.feature && layer.feature.properties ? layer.feature.properties : {};
      const html = Object.keys(p).map(k => `<div><b>${k}</b>: ${p[k]}</div>`).join('');
      return html || 'Ingen attributter';
    });

    // Enkel forklaring
